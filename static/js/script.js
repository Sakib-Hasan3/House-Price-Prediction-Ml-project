// Additional JavaScript functionality

// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    // Add tooltips to form inputs
    const tooltips = {
        'bedrooms': 'Number of bedrooms in the property',
        'bathrooms': 'Number of bathrooms in the property',
        'floor_no': 'Floor number (ground floor = 1)',
        'floor_area': 'Total floor area in square feet',
        'city': 'City where property is located',
        'area': 'Specific area or neighborhood'
    };

    // Add input validation
    const floorAreaInput = document.getElementById('floor_area');
    if (floorAreaInput) {
        floorAreaInput.addEventListener('input', function() {
            const areaRange = document.getElementById('area_range');
            if (areaRange) {
                areaRange.value = this.value;
            }
        });
    }

    const areaRange = document.getElementById('area_range');
    if (areaRange) {
        areaRange.addEventListener('input', function() {
            const floorAreaInput = document.getElementById('floor_area');
            if (floorAreaInput) {
                floorAreaInput.value = this.value;
            }
        });
    }

    // Add animation to form submission
    const form = document.getElementById('predictionForm');
    if (form) {
        form.addEventListener('submit', function() {
            const submitBtn = this.querySelector('.btn-predict');
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Predicting...';
                submitBtn.disabled = true;
            }
        });
    }

    // Load saved form data if available
    loadSavedFormData();
});

// Save form data to localStorage
function saveFormData() {
    const formData = {};
    const form = document.getElementById('predictionForm');
    if (form) {
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => {
            if (input.name) {
                formData[input.name] = input.value;
            }
        });
        localStorage.setItem('housePriceFormData', JSON.stringify(formData));
    }
}

// Load saved form data
function loadSavedFormData() {
    const savedData = localStorage.getItem('housePriceFormData');
    if (savedData) {
        const formData = JSON.parse(savedData);
        const form = document.getElementById('predictionForm');
        if (form) {
            Object.keys(formData).forEach(key => {
                const input = form.querySelector(`[name="${key}"]`);
                if (input) {
                    input.value = formData[key];
                }
            });
        }
    }
}

// Auto-save form data on change
document.addEventListener('input', function(e) {
    if (e.target.closest('#predictionForm')) {
        saveFormData();
    }
});

// Currency formatting
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-BD', {
        style: 'currency',
        currency: 'BDT',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(amount);
}

// Share prediction result
function shareResult() {
    const result = {
        price: document.getElementById('mainPrice')?.textContent || '',
        details: {
            bedrooms: document.getElementById('detailBedrooms')?.textContent || '',
            bathrooms: document.getElementById('detailBathrooms')?.textContent || '',
            area: document.getElementById('detailArea')?.textContent || '',
            location: document.getElementById('detailLocation')?.textContent || ''
        }
    };

    const shareText = `üè† Predicted House Price: ${result.price}\n` +
                     `Bedrooms: ${result.details.bedrooms} | Bathrooms: ${result.details.bathrooms}\n` +
                     `Area: ${result.details.area}\n` +
                     `Location: ${result.details.location}\n\n` +
                     `Generated by Bangladesh House Price Predictor`;
    if (navigator.share) {
        navigator.share({
            title: 'House Price Prediction',
            text: shareText,
            url: window.location.href
        }).catch(function(err) {
            console.warn('Native share failed:', err);
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(shareText)
                    .then(function() { alert('Share text copied to clipboard'); })
                    .catch(function() { alert('Could not copy share text'); });
            } else {
                var textarea = document.createElement('textarea');
                textarea.value = shareText;
                document.body.appendChild(textarea);
                textarea.select();
                try { document.execCommand('copy'); alert('Share text copied to clipboard'); }
                catch(e) { alert('Could not copy share text'); }
                document.body.removeChild(textarea);
            }
        });
    } else {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(shareText)
                .then(function() { alert('Share text copied to clipboard'); })
                .catch(function() { alert('Could not copy share text'); });
        } else {
            var textarea = document.createElement('textarea');
            textarea.value = shareText;
            document.body.appendChild(textarea);
            textarea.select();
            try { document.execCommand('copy'); alert('Share text copied to clipboard'); }
            catch(e) { alert('Could not copy share text'); }
            document.body.removeChild(textarea);
        }
    }
}